<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Decision NAVigator — D-NAV Mini (v3.20)</title>
<style>
:root{--bg:#0b0f14;--card:#121821;--muted:#8fa1b7;--text:#e9eef5;--green:#3ecf8e;--red:#ff6b6b;--amber:#f3b431;--blue:#69a9ff}
*{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
body{background:var(--bg);color:var(--text);margin:0;padding:24px}

/* Page banner */
.site-title{max-width:1200px;margin:0 auto 12px auto;padding:8px 2px;font-weight:900;letter-spacing:.2px}
.site-title h0{display:block;font-size:28px;font-weight:900;line-height:1;margin:0}
.site-title .sub{color:var(--muted);font-size:13px;margin-top:6px}

/* Layout */
.wrap{
  max-width:1200px;
  margin:0 auto;
  display:grid;
  gap:16px;
  grid-template-columns:1fr 1fr 1fr;
  align-items:stretch;
}
.wrap + .wrap{ margin-top:16px }

.card{background:var(--card);border-radius:16px;padding:16px;box-shadow:0 10px 24px rgba(0,0,0,.35);height:100%;display:flex;flex-direction:column}
h1{margin:0 0 8px;font-weight:800;font-size:22px;letter-spacing:.2px}

/* Slider rows */
.row{display:grid;grid-template-columns:180px 1fr 52px;gap:12px;align-items:center;margin:10px 0 12px}
.row:last-of-type{margin-bottom:8px}
.row label{font-weight:700;color:#d7e2ef;font-size:16px;display:flex;flex-direction:column;gap:4px}
.label-main{line-height:1}
.hint{font-weight:600;color:var(--muted);font-size:12px;line-height:1.2}
input[type=range]{width:100%;height:32px}
output{text-align:right;display:inline-block;min-width:40px;font-weight:800;font-size:16px}
.muted{color:var(--muted);font-size:13px}
.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}

/* Stats */
.stats{display:grid;grid-template-rows:repeat(3,1fr);gap:12px}
.stat{background:rgba(255,255,255,.04);border-radius:12px;padding:14px;min-height:110px;display:flex;flex-direction:column;justify-content:space-between}
.stat h3{margin:0;font-size:12px;color:#9fb1c7;letter-spacing:.3px;text-transform:uppercase}
.val{font-size:36px;font-weight:900;line-height:1.1}

/* compact pills */
.pill{display:inline-block;padding:3px 7px;border-radius:999px;font-weight:800;font-size:10.5px;line-height:1;white-space:nowrap}
.green{background:rgba(62,207,142,.18);color:var(--green);border:1px solid rgba(62,207,142,.4)}
.amber{background:rgba(243,180,49,.18);color:var(--amber);border:1px solid rgba(243,180,49,.35)}
.red{background:rgba(255,107,107,.18);color:var(--red);border:1px solid rgba(255,107,107,.4)}

/* Summary */
.summary{display:grid;grid-template-rows:auto auto 1fr;gap:12px}
.arch h3,.comp h3,.coach h3{margin:0;font-size:12px;color:#9fb1c7;text-transform:uppercase;letter-spacing:.3px}
.arch .name{font-size:26px;font-weight:900;margin-top:6px}
.arch .desc{color:#c9d4e6;margin-top:6px}
.comp .big{font-size:44px;font-weight:900;margin-top:6px}
.comp .tag,.comp .breakdown{margin-top:4px;font-size:12px;color:#a7b4c7}
.coach .txt{margin-top:6px;color:#c9d4e6;line-height:1.55}

/* Entry & Log */
.grid{display:grid;gap:12px}
.input{padding:10px;border:1px solid #333;border-radius:10px;background:#0f141b;color:var(--text)}
.btn{padding:12px 16px;border-radius:12px;border:0;background:#111;color:#fff;font-weight:700;cursor:pointer}
.btn[disabled]{opacity:.5;cursor:not-allowed}
.btn.secondary{background:#0f141b;border:1px solid #444}
.table-wrap{overflow:auto;border:1px solid #222;border-radius:12px}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:10px}
thead{background:#0d0d0d;color:#fff}
tr+tr{border-top:1px solid #1e1e1e}

/* numeric alignment for table */
.num{text-align:right;font-variant-numeric:tabular-nums;font-feature-settings:"tnum" 1,"lnum" 1}
tbody tr:nth-child(even){background:rgba(255,255,255,.02)}

/* === Stats HUD tiles === */
.kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-top:10px}
.kpi{background:rgba(255,255,255,.04);border-radius:12px;padding:12px 14px;position:relative}
.kpi h4{margin:0;font-size:12px;color:#9fb1c7;letter-spacing:.3px;text-transform:uppercase}
.kpi .big{font-size:28px;font-weight:900;margin-top:6px}
.mini{font-size:12px;color:#a7b4c7;margin-top:4px}
.progress{height:8px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden;margin-top:8px}
.progress>span{display:block;height:100%;transition:width .45s ease}

/* Category list */
.alloc{margin-top:12px}
.alloc .row{display:grid;grid-template-columns:160px 1fr 260px;gap:12px;align-items:center;padding:6px 0;border-bottom:1px solid rgba(255,255,255,.06)}
.alloc .row:last-child{border-bottom:none}
.alloc .bar{height:8px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden}
.alloc .bar>span{display:block;height:100%;background:var(--blue);transition:width .45s ease}
.alloc .meta{font-size:12px;color:#a7b4c7;text-align:right}

/* Footer links (no boxes) */
.footer-links{max-width:1200px;margin:20px auto 10px;text-align:right}
.footer-links a{font-size:18px;color:#cfe1ff;text-decoration:underline;text-underline-offset:4px;margin-left:22px}

/* pulse */
@keyframes pulse-kpi{0%{box-shadow:0 0 0 0 rgba(105,169,255,.35)}100%{box-shadow:0 0 0 14px rgba(105,169,255,0)}}
.kpi.pulse{animation:pulse-kpi .6s ease}

/* Mobile */
@media (max-width:900px){
  body{padding:14px}
  .site-title h0{font-size:24px}
  .wrap{grid-template-columns:1fr}
  .row{grid-template-columns:1fr 1fr 46px}
  h1{font-size:20px}
  .val{font-size:32px}
  .comp .big{font-size:38px}
  input[type=range]{height:36px}
  .kpis{grid-template-columns:1fr 1fr}
  .alloc .row{grid-template-columns:1fr}
  .alloc .meta{text-align:left}
}
</style>
</head>
<body>

<!-- Page banner -->
<div class="site-title">
  <h0>The Decision NAVigator</h0>
  <div class="sub">Bring clarity to complex decisions.</div>
</div>

<div class="wrap">
  <div class="card">
    <h1>D-NAV Variables</h1>
    <div class="muted">Input D-NAV variables.</div>

    <!-- Sliders with micro-explainers -->
    <div class="row">
      <label><span class="label-main">Impact</span><span class="hint">Expected benefit / upside.</span></label>
      <input id="impact" type="range" min="1" max="10" value="1" />
      <output id="o_impact">1</output>
    </div>

    <div class="row">
      <label><span class="label-main">Cost</span><span class="hint">Money, time, or effort required.</span></label>
      <input id="cost" type="range" min="1" max="10" value="1" />
      <output id="o_cost">1</output>
    </div>

    <div class="row">
      <label><span class="label-main">Risk</span><span class="hint">Chance and size of downside.</span></label>
      <input id="risk" type="range" min="1" max="10" value="1" />
      <output id="o_risk">1</output>
    </div>

    <div class="row">
      <label><span class="label-main">Urgency</span><span class="hint">How soon action is needed.</span></label>
      <input id="urgency" type="range" min="1" max="10" value="1" />
      <output id="o_urgency">1</output>
    </div>

    <div class="row">
      <label><span class="label-main">Confidence</span><span class="hint">Evidence, readiness, and conviction.</span></label>
      <input id="confidence" type="range" min="1" max="10" value="1" />
      <output id="o_confidence">1</output>
    </div>

    <div class="muted">Formula: <span class="mono">(Impact − Cost − Risk) + (Urgency × Confidence)</span></div>
  </div>

  <div class="card stats">
    <div class="stat"><h3>Return</h3><div class="val" id="ret">0</div><span id="retPill" class="pill amber">Neutral</span></div>
    <div class="stat"><h3>Stability</h3><div class="val" id="stab">0</div><span id="stabPill" class="pill amber">Uncertain</span></div>
    <div class="stat"><h3>Pressure</h3><div class="val" id="press">0</div><span id="pressPill" class="pill amber">Balanced</span></div>
  </div>

  <div class="card summary">
    <div class="arch"><h3>Archetype</h3><div id="arch" class="name">Routine</div><div id="archDesc" class="desc">Flat with uncertain footing — balanced execution.</div></div>
    <div class="comp">
      <h3>Composite (D-NAV)</h3>
      <div id="score" class="big">0</div>
      <div id="scoreTag" class="tag">Low D-NAV — Low energy</div>
      <div class="breakdown">Merit: <span id="meritVal" class="mono">0</span> • Drive: <span id="driveVal" class="mono">0</span></div>
    </div>
    <div class="coach"><h3>Coach Readout</h3><div id="coach" class="txt">Greenlight profile — execute with discipline.</div></div>
  </div>
</div>

<!-- ENTRY -->
<div class="wrap" style="grid-template-columns:1fr 1fr;">
  <div class="card grid">
    <h2 style="margin:0;">Quick Entry</h2>
    <input id="decisionName" class="input" type="text" placeholder="Decision name (e.g., ‘Investor meetup solo’)" />
    <input id="decisionCategory" class="input" type="text" placeholder="Category (e.g., Career, Health, Relationships)" />
    <button id="enterBtn" class="btn" disabled>Enter decision</button>
    <div class="muted">Fill name & category, set sliders → click <b>Enter decision</b>. Stored on this device.</div>
  </div>

  <!-- IMPORT / TEMPLATES -->
  <div class="card grid">
    <h2 style="margin:0;">Import / Templates</h2>
    <input id="csvInput" type="file" accept=".csv,text/csv" class="input" />
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button id="uploadBtn" class="btn" disabled>Upload CSV</button>
      <button id="tmplBlank" class="btn secondary">Blank Template</button>
      <button id="tmplPersonal" class="btn secondary">Personal Template</button>
      <button id="tmplBusiness" class="btn secondary">Business Template</button>
      <button id="tmplInvestor" class="btn secondary">Investor Template</button>
    </div>
    <div id="uploadMsg" class="muted"></div>
    <div class="muted" style="margin-top:6px;">
      Don’t have a template? Use one of ours.<br/>
      Personal: “100 Life Decisions That Shape You” • Business: “50 Strategic Decisions Every Founder Makes” • Investor: “Quarterly Capital Allocation Model”.<br/>
      <span style="opacity:.9">Tip: you can include <b>prompt</b> and leave scores blank to fill later.</span>
    </div>
  </div>
</div>

<!-- STATS HUD -->
<div class="wrap" style="grid-template-columns:1fr;">
  <div class="card">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <h2 style="margin:0;">Your Decision Stats</h2>
      <select id="rangeSelect" class="input" style="width:160px;padding:8px 10px;">
        <option value="0">All time</option>
        <option value="7">Last 7 days</option>
        <option value="30">Last 30 days</option>
      </select>
    </div>
    <div class="kpis">
      <div class="kpi" id="tile_total">
        <h4>Decisions</h4>
        <div class="big" id="k_total" data-val="0">0</div>
        <div class="mini" id="k_recent">(0 in range)</div>
      </div>
      <div class="kpi" id="tile_avg">
        <h4>Avg D-NAV</h4>
        <div class="big" id="k_avgdnav" data-val="0">0</div>
        <div class="mini">Composite (Merit + Drive)</div>
      </div>
      <div class="kpi" id="tile_pos">
        <h4>Return</h4>
        <div class="big" id="k_posret" data-val="0">0%</div>
        <div class="progress"><span id="bar_posret" style="width:0%;background:var(--green)"></span></div>
      </div>
      <div class="kpi" id="tile_stable">
        <h4>Stable</h4>
        <div class="big" id="k_stable" data-val="0">0%</div>
        <div class="progress"><span id="bar_stable" style="width:0%;background:var(--green)"></span></div>
      </div>
      <div class="kpi" id="tile_press">
        <h4>Pressured</h4>
        <div class="big" id="k_pressured" data-val="0">0%</div>
        <div class="progress"><span id="bar_press" style="width:0%;background:var(--red)"></span></div>
      </div>
    </div>

    <h3 id="allocTitle" style="margin:14px 0 6px;">Drive (U×C) by category</h3>
    <div class="alloc" id="allocList"></div>

    <div class="mini" id="k_misc" style="margin-top:8px;">Top category: — • Top archetype: —</div>
  </div>
</div>

<!-- LOG -->
<div class="wrap" style="grid-template-columns:1fr;">
  <div class="card grid">
    <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;">
      <h2 style="margin:0;">Decision Log</h2>
      <div style="display:flex;gap:8px;">
        <button id="downloadPdfBtn" class="btn secondary">Download PDF</button>
        <button id="downloadCsvBtn" class="btn secondary">Download CSV</button>
        <button id="clearLogBtn" class="btn secondary">Clear</button>
      </div>
    </div>
    <div class="table-wrap">
      <table id="logTable">
        <thead>
          <tr>
            <th>When</th>
            <th>Name</th>
            <th>Category</th>
            <th style="text-align:right;">Impact</th>
            <th style="text-align:right;">Cost</th>
            <th style="text-align:right;">Risk</th>
            <th style="text-align:right;">Urgency</th>
            <th style="text-align:right;">Confidence</th>
            <th style="text-align:right;">Return</th>
            <th style="text-align:right;">Pressure</th>
            <th style="text-align:right;">Stability</th>
            <th style="text-align:right;">D-NAV</th>
            <th style="text-align:center;">✕</th>
          </tr>
        </thead>
        <tbody id="logBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- FOOTER LINKS (no boxes) -->
<div class="footer-links">
  <a href="/definitions.html">View definitions & archetypes</a>
  <a target="_blank" rel="noopener noreferrer" href="https://decisionnavigator.gumroad.com/">Start tracking all of your decisions</a>
</div>

<div style="display:flex;flex:1;justify-content:center;align-items:center;margin-top:4px;">
  <img src="./logo.PNG" style="background-color:#c9d4e6;width:100px;height:100px;border-radius:8px;" alt="D-NAV logo"/>
</div>

<script>
/* ---- One-word archetypes (keyed by P|S|R) ---- */
const oneWord={
  "1|1|1":"Breakthrough","0|1|1":"Advance","-1|1|1":"Harvest",
  "1|0|1":"Sprint","0|0|1":"Build","-1|0|1":"Coast",
  "1|-1|1":"Gamble","0|-1|1":"Moonshot","-1|-1|1":"Prospect",
  "1|1|0":"Grind","0|1|0":"Maintain","-1|1|0":"Idle",
  "1|0|0":"Firefight","0|0|0":"Routine","-1|0|0":"Drift",
  "1|-1|0":"Strain","0|-1|0":"Wobble","-1|-1|0":"Teeter",
  "1|1|-1":"Overreach","0|1|-1":"Erode","-1|1|-1":"Complacency",
  "1|0|-1":"Burn","0|0|-1":"Waste","-1|0|-1":"Leak",
  "1|-1|-1":"Meltdown","0|-1|-1":"Collapse","-1|-1|-1":"Decay"
};

/* descriptor line */
const Pword = s => s>0?'Pressured':(s<0?'Calm':'Balanced');
const Sword = s => s>0?'Stable':(s<0?'Fragile':'Uncertain');
const Rword = s => s>0?'Gain':(s<0?'Loss':'Flat');
const lineFor = (p,s,r) => `${Rword(r)} with ${Sword(s).toLowerCase()} footing — ${Pword(p).toLowerCase()} execution.`;

/* Helpers */
function sign3(x){return x>0?1:x<0?-1:0;}
function badge(el,state,pw,nw,gw){el.className="pill "+(state>0?"green":(state<0?"red":"amber"));el.textContent=state>0?pw:(state<0?gw:nw);}
function scoreTagText(n){return n>=80?"Very high D-NAV":n>=50?"High D-NAV":n>=25?"Moderate D-NAV":"Low D-NAV";}

/* Energy tiers */
function energyTier(u, c){
  const e = (u||0) * (c||0);
  if (e >= 71) return {e, name:"Overdrive energy", short:"overdrive"};
  if (e >= 41) return {e, name:"High energy",      short:"high"};
  if (e >= 16) return {e, name:"Moderate energy",  short:"moderate"};
  return {e, name:"Low energy", short:"low"};
}

/* Coach — deduped suggestions */
function coachHint({ret, stab, press, urg, conf, impact, cost, risk}){
  const et = energyTier(urg, conf);
  let sugs = [];
  const needRaiseImpact = (impact <= cost) && (ret <= 0);
  const needLowerCosts  = (impact <= cost) && (ret <= 0);
  const needLowerRisks  = (risk >= conf);
  const needAddEvidence = (stab <= 0);
  const needNarrowScope = (press > 0);
  const needAddCapacity = (press > 0 && (et.short === "overdrive" || et.short === "high"));

  if (needRaiseImpact) sugs.push("raise impact");
  if (needLowerCosts)  sugs.push("lower costs");
  if (needLowerRisks)  sugs.push("lower risks");
  if (needAddEvidence) sugs.push("add evidence");
  if (needNarrowScope) sugs.push("narrow scope");
  if (needAddCapacity) sugs.push("add capacity");

  const hasCosts = sugs.includes("lower costs");
  const hasRisks = sugs.includes("lower risks");
  if (hasCosts || hasRisks){
    sugs = sugs.filter(s=>s!=="lower costs" && s!=="lower risks");
    sugs.push(hasCosts && hasRisks ? "lower costs and/or risks" : (hasCosts ? "lower costs" : "lower risks"));
  }

  sugs = [...new Set(sugs)].slice(0,2);
  const leverLine = sugs.length ? " — " + sugs.join("; ") + "." : ".";

  if (ret < 0){
    const base = (et.short==="high"||et.short==="overdrive")
      ? "High energy chasing negative return — stop or pivot"
      : "Negative return — improve unit economics";
    return base + leverLine;
  }

  if (ret === 0){
    let base = "Neutral return";
    if (press > 0 && stab <= 0) base += " under pressure on fragile footing";
    else if (press > 0)         base += " under pressure";
    else if (stab <= 0)         base += " but fragile";
    return base + leverLine;
  }

  if (stab <= 0 && press > 0) return "Upside with fragile footing and pressure" + leverLine;
  if (stab <= 0)              return "Upside but fragile — shore up footing before scaling" + leverLine;
  if (press > 0)              return "Good profile, but pressured" + leverLine;
  return sugs.length ? "Greenlight profile" + leverLine : "Greenlight profile — execute with discipline.";
}

function compute(){
  const impact=+document.getElementById('impact').value;
  const cost=+document.getElementById('cost').value;
  const risk=+document.getElementById('risk').value;
  const urgency=+document.getElementById('urgency').value;
  const confidence=+document.getElementById('confidence').value;

  document.getElementById('o_impact').textContent=impact;
  document.getElementById('o_cost').textContent=cost;
  document.getElementById('o_risk').textContent=risk;
  document.getElementById('o_urgency').textContent=urgency;
  document.getElementById('o_confidence').textContent=confidence;

  const ret = impact - cost;
  const stab = confidence - risk;
  const press = urgency - confidence;
  const merit = impact - cost - risk;
  const eInfo = energyTier(urgency, confidence);
  const composite = merit + eInfo.e;
  const s = x => x>0?('+'+x):(x<0?x.toString():'0');

  document.getElementById('ret').textContent=s(ret);
  document.getElementById('stab').textContent=s(stab);
  document.getElementById('press').textContent=s(press);

  badge(document.getElementById('retPill'),Math.sign(ret),'Positive','Neutral','Negative');
  badge(document.getElementById('stabPill'),Math.sign(stab),'Stable','Uncertain','Fragile');

  const pressPill = document.getElementById('pressPill');
  pressPill.textContent = press > 0 ? 'Pressured' : (press < 0 ? 'Calm' : 'Balanced');
  pressPill.className = 'pill ' + (press > 0 ? 'red' : (press < 0 ? 'green' : 'amber'));

  const pS=sign3(press), sS=sign3(stab), rS=sign3(ret);
  const name=oneWord[[pS,sS,rS].join('|')]||'Unclassified';
  document.getElementById('arch').textContent=name;
  document.getElementById('archDesc').textContent=lineFor(pS,sS,rS);

  document.getElementById('score').textContent=composite;
  document.getElementById('scoreTag').textContent = `${scoreTagText(composite)} — ${eInfo.name}`;
  document.getElementById('meritVal').textContent = merit;
  document.getElementById('driveVal').textContent = eInfo.e;

  document.getElementById('coach').textContent = coachHint({
    ret, stab, press, urg: urgency, conf: confidence, impact, cost, risk
  });
}

/* ---------- CSV / PDF / Stats / Log ---------- */
function fmtLocal(ts){
  const d = new Date(ts);
  const z = n=>String(n).padStart(2,'0');
  return `${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())} ${z(d.getHours())}:${z(d.getMinutes())}:${z(d.getSeconds())}`;
}
const $ = (sel) => document.querySelector(sel);
const SLIDER_IDS = ["impact","cost","risk","urgency","confidence"];
const fmt0 = (n) => Number(n).toFixed(0);
function energyLabel(e){ if (e>=71) return "Overdrive energy"; if (e>=41) return "High energy"; if (e>=16) return "Moderate energy"; return "Low energy"; }
function readCurrent(){ const out={}; SLIDER_IDS.forEach(id=>out[id]=Number($('#'+id).value||0)); return out; }
function computeMetrics(v){
  const ret=v.impact - v.cost;
  const pressure=v.urgency - v.confidence;
  const stability=v.confidence - v.risk;
  const merit = v.impact - v.cost - v.risk;
  const eInfo = energyTier(v.urgency, v.confidence);
  const dnav = merit + eInfo.e;
  return {ret,pressure,stability,dnav,merit,energy:eInfo.e};
}
function loadLog(){ try{ return JSON.parse(localStorage.getItem('dnav_log_v1')||'[]'); }catch{ return []; } }
function saveLog(arr){ localStorage.setItem('dnav_log_v1', JSON.stringify(arr)); }
function escapeHtml(s=''){ return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* CSV utilities */
function parseCSV(text){
  const rows=[]; let i=0, cur=[], val='', inQ=false;
  while(i<text.length){
    const c=text[i];
    if(inQ){
      if(c==='"' && text[i+1]==='"'){ val+='"'; i+=2; continue; }
      if(c==='"' ){ inQ=false; i++; continue; }
      val+=c; i++; continue;
    }else{
      if(c==='"' ){ inQ=true; i++; continue; }
      if(c===','){ cur.push(val); val=''; i++; continue; }
      if(c==='\n'){ cur.push(val); rows.push(cur); cur=[]; val=''; i++; continue; }
      if(c==='\r'){ // handle CRLF
        if(text[i+1]==='\n'){ i+=2; cur.push(val); rows.push(cur); cur=[]; val=''; continue; }
        cur.push(val); rows.push(cur); cur=[]; val=''; i++; continue;
      }
      val+=c; i++; continue;
    }
  }
  cur.push(val); rows.push(cur);
  // trim trailing empty lines
  while(rows.length && rows[rows.length-1].every(x=>x==='')) rows.pop();
  return rows;
}
const headerAliases = {
  name:['name','decision','title','decision_name'],
  category:['category','cat'],
  impact:['impact','i'],
  cost:['cost','c'],
  risk:['risk','r'],
  urgency:['urgency','u'],
  confidence:['confidence','conf'],
  // optional
  timestamp:['timestamp','when','date','time','timestamp_iso','timestamp_local','ts'],
  prompt:['prompt','question']
};
function findHeaderIndex(headers, key){
  const lowers=headers.map(h=>String(h||'').trim().toLowerCase());
  const cands=headerAliases[key]||[key];
  for(const cand of cands){
    const idx=lowers.indexOf(cand);
    if(idx>-1) return idx;
  }
  return -1;
}
function toNumberOrNull(x){
  if(x===undefined || x===null) return null;
  const n=Number(String(x).trim());
  return Number.isFinite(n) ? n : null;
}

/* Templates (CSV blobs) */
function downloadCSV(filename, csv){
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download=filename;
  a.click();
  URL.revokeObjectURL(a.href);
}
function universalHeader(){
  return ['prompt','name','category','impact','cost','risk','urgency','confidence'].join(',');
}
function blankTemplate(){
  const csv = universalHeader() + '\n';
  downloadCSV('dnav_template_blank.csv', csv);
}
function personalTemplate(){
  const rows = [
    ['Choose a primary career direction for the next 12 months','','Career','','','','',''],
    ['Establish a daily training routine (run/lift)','','Health & Fitness','','','','',''],
    ['Move to a new city or stay put?','','Lifestyle','','','','',''],
    ['Start a newsletter about my expertise','','Career','','','','',''],
    ['Prioritize sleep: set a strict bedtime','','Health & Fitness','','','','','']
  ].map(r=>r.map(x=>typeof x==="string" ? `"${x.replace(/"/g,'""')}"` : x).join(','));
  const csv = [universalHeader(), ...rows].join('\n');
  downloadCSV('dnav_template_personal.csv', csv);
}
function businessTemplate(){
  const rows = [
    ['Define ICP and core offer','','Business','','','','',''],
    ['Ship v1 landing page with lead magnet','','Business','','','','',''],
    ['Choose pricing tier and guarantee','','Business','','','','',''],
    ['Hire first contractor (design/dev)','','Team','','','','',''],
    ['Launch weekly content cadence','','Marketing','','','','','']
  ].map(r=>r.map(x=>typeof x==="string" ? `"${x.replace(/"/g,'""')}"` : x).join(','));
  const csv = [universalHeader(), ...rows].join('\n');
  downloadCSV('dnav_template_business.csv', csv);
}
function investorTemplate(){
  const rows = [
    ['Rebalance: shift 5–10% into cash?','','Portfolio','','','','',''],
    ['Allocate to data-center REITs this quarter','','Equities','','','','',''],
    ['Add a private deal (check IRR & risk)','','Private Markets','','','','',''],
    ['Exit underperformer before Q4?','','Portfolio','','','','',''],
    ['Hedge tail risk (puts/vol)','','Risk Mgmt','','','','','']
  ].map(r=>r.map(x=>typeof x==="string" ? `"${x.replace(/"/g,'""')}"` : x).join(','));
  const csv = [universalHeader(), ...rows].join('\n');
  downloadCSV('dnav_template_investor.csv', csv);
}

/* Import pipeline */
function importCSV(text){
  const rows=parseCSV(text);
  if(!rows.length) throw new Error('CSV appears empty.');
  const headers=rows[0]; const data=rows.slice(1);

  const idx={
    name: findHeaderIndex(headers,'name'),
    category: findHeaderIndex(headers,'category'),
    impact: findHeaderIndex(headers,'impact'),
    cost: findHeaderIndex(headers,'cost'),
    risk: findHeaderIndex(headers,'risk'),
    urgency: findHeaderIndex(headers,'urgency'),
    confidence: findHeaderIndex(headers,'confidence'),
    timestamp: findHeaderIndex(headers,'timestamp'),
    prompt: findHeaderIndex(headers,'prompt')
  };

  if(idx.name===-1 && idx.prompt===-1)
    throw new Error('Missing a "name" or "prompt" column.');
  if(idx.category===-1)
    throw new Error('Missing a "category" column.');
  // scores can be blank; users can fill later

  const imported=[];
  for(const row of data){
    const nameRaw = idx.name>-1 ? row[idx.name] : '';
    const promptRaw = idx.prompt>-1 ? row[idx.prompt] : '';
    const name = String((nameRaw||'').trim() || (promptRaw||'').trim());
    const category = String((row[idx.category]||'').trim());
    if(!name && !category) continue; // skip empty lines
    if(!category) throw new Error('Some rows are missing Category.');

    const vals = {
      impact: toNumberOrNull(idx.impact>-1 ? row[idx.impact] : null) ?? 0,
      cost: toNumberOrNull(idx.cost>-1 ? row[idx.cost] : null) ?? 0,
      risk: toNumberOrNull(idx.risk>-1 ? row[idx.risk] : null) ?? 0,
      urgency: toNumberOrNull(idx.urgency>-1 ? row[idx.urgency] : null) ?? 0,
      confidence: toNumberOrNull(idx.confidence>-1 ? row[idx.confidence] : null) ?? 0
    };

    // if scores are all zero (blank template), we still import for backlog
    const m = computeMetrics(vals);

    // timestamp (optional)
    let ts = Date.now();
    if(idx.timestamp>-1){
      const tRaw = row[idx.timestamp];
      const tms = Date.parse(tRaw);
      if(Number.isFinite(tms)) ts = tms;
    }

    imported.push({
      ts,
      name,
      category,
      ...vals,
      return:m.ret, pressure:m.pressure, stability:m.stability, merit:m.merit, energy:m.energy, dnav:m.dnav
    });
  }

  if(!imported.length) throw new Error('No usable rows were found.');

  const current = loadLog();
  // newest first: put imported at the top, preserving their ts order (descending)
  imported.sort((a,b)=>b.ts-a.ts);
  const merged = [...imported, ...current];
  saveLog(merged);
  return {count: imported.length};
}

function toCsv(rows){
  const header=['timestamp_local','timestamp_iso','name','category','impact','cost','risk','urgency','confidence','return','pressure','stability','merit','energy','dnav'];
  const body=rows.map(r=>[
    fmtLocal(r.ts), new Date(r.ts).toISOString(),
    `"${(r.name||'').replace(/"/g,'""')}"`,
    `"${(r.category||'').replace(/"/g,'""')}"`,
    r.impact,r.cost,r.risk,r.urgency,r.confidence,r.return,r.pressure,r.stability,r.merit,r.energy,r.dnav
  ].join(','));
  return [header.join(','),...body].join('\n');
}
function downloadCsv(){
  const rows=loadLog();
  if(!rows.length){ alert('No decisions logged yet.'); return; }
  const blob=new Blob([toCsv(rows)],{type:'text/csv;charset=utf-8;'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='dnav_decisions.csv';
  a.click();
  URL.revokeObjectURL(a.href);
}

/* ----------- Compact PDF report ----------- */
function openPdfReport(){
  const rows = loadLog();
  const total = rows.length;

  const avg = total ? Math.round(rows.reduce((a,r)=>a + (Number(r.dnav)||0),0)/total) : 0;
  const posRet = total ? Math.round(rows.filter(r=>r.return>0).length*100/total) : 0;
  const pressuredPct = total ? Math.round(rows.filter(r=>r.pressure>0).length*100/total) : 0;
  const stablePct = total ? Math.round(rows.filter(r=>r.stability>0).length*100/total) : 0;

  const pct = (n,d)=> d ? Math.round(n*100/d) : 0;
  const retPos = rows.filter(r=>r.return>0).length;
  const retNeu = rows.filter(r=>r.return===0).length;
  const retNeg = rows.filter(r=>r.return<0).length;

  const stabSt = rows.filter(r=>r.stability>0).length;
  const stabUn = rows.filter(r=>r.stability===0).length;
  const stabFr = rows.filter(r=>r.stability<0).length;

  const prPress = rows.filter(r=>r.pressure>0).length;
  const prBal   = rows.filter(r=>r.pressure===0).length;
  const prCalm  = rows.filter(r=>r.pressure<0).length;

  // Category breakdown
  const totals = new Map(); let energyAll = 0;
  rows.forEach(r=>{
    const cat=(r.category||'').trim()||'Uncategorized';
    const e=(r.urgency||0)*(r.confidence||0);
    energyAll+=e;
    if(!totals.has(cat)) totals.set(cat,{energy:0,count:0,sumD:0,press:0,stable:0});
    const t=totals.get(cat);
    t.energy+=e; t.count+=1; t.sumD+=(Number(r.dnav)||0);
    if((r.pressure||0)>0) t.press+=1;
    if((r.stability||0)>0) t.stable+=1;
  });
  const catRows = Array.from(totals.entries()).map(([cat,t])=>({
    cat,
    share: energyAll? Math.round(t.energy*100/energyAll) : 0,
    avgD: t.count? Math.round(t.sumD / t.count) : 0,
    count: t.count,
    pr: t.count? Math.round(t.press*100/t.count) : 0,
    st: t.count? Math.round(t.stable*100/t.count) : 0
  })).sort((a,b)=>b.share-a.share).slice(0,10);

  const dt = new Date().toLocaleString();

  const html = `
  <html><head><meta charset="utf-8" />
    <title>D-NAV Insights</title>
    <style>
      :root{--bg:#0b0f14;--card:#121821;--text:#e9eef5;--muted:#a7b4c7;--g:#3ecf8e;--r:#ff6b6b;--a:#f3b431;--blue:#69a9ff}
      *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:14px/1.35 Inter,system-ui,Segoe UI,Roboto,Arial}
      .container{max-width:1200px;margin:0 auto;padding:24px}
      h1{margin:0 0 12px;font-size:22px;font-weight:900}
      h2{margin:14px 0 8px;font-size:16px}
      .card{background:var(--card);border-radius:12px;padding:12px;margin:10px 0}
      .kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
      .kpi{background:rgba(255,255,255,.05);border-radius:10px;padding:10px}
      .kpi h4{margin:0;font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.3px}
      .big{font-size:22px;font-weight:900;margin-top:4px}
      .stack{height:10px;border-radius:999px;background:rgba(255,255,255,.09);display:flex;overflow:hidden;margin-top:6px}
      .seg{height:100%}.g{background:rgba(62,207,142,.85)}.a{background:rgba(243,180,49,.85)}.r{background:rgba(255,107,107,.85)}
      .legend{display:flex;gap:12px;flex-wrap:wrap;color:var(--muted);font-size:12px;margin-top:6px}
      .rows{margin-top:6px}
      .rows .row{display:grid;grid-template-columns:140px 1fr 240px;gap:10px;align-items:center;padding:4px 0;border-bottom:1px solid rgba(255,255,255,.06)}
      .rows .row:last-child{border-bottom:0}
      .bar{height:8px;border-radius:999px;background:rgba(255,255,255,.09);overflow:hidden}
      .bar>span{display:block;height:100%;background:var(--blue)}
      table{width:100%;border-collapse:collapse;font-size:12.5px}
      th,td{padding:6px 8px;border-bottom:1px solid rgba(255,255,255,.08)} th{color:#cfe1ff;text-align:left}
      td.right{text-align:right}
      .top{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px}
      .top a{color:#cfe1ff;text-decoration:underline;text-underline-offset:3px;font-size:13px}
      .mini{color:var(--muted);font-size:12px}
      .cta{margin-top:10px;text-align:center}
      .cta a{color:#cfe1ff;text-decoration:underline;text-underline-offset:4px}
      @media print{
        body{background:#fff;color:#000}
        .card{background:#fff;border:1px solid #ddd}
        .kpi,.stack,.bar{background:#eee}
        .g{background:#4caf50}.a{background:#ffb300}.r{background:#ef5350}
        .top a{display:none}
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="top">
        <h1>D-NAV Insights</h1>
        <a href="#" onclick="window.print();return false;">Print / Save as PDF</a>
      </div>
      <div class="card"><b>Generated:</b> ${dt} <span class="mini">• Based on your saved decisions.</span></div>

      <div class="kpis">
        <div class="kpi"><h4>Decisions</h4><div class="big">${total}</div></div>
        <div class="kpi"><h4>Avg D-NAV</h4><div class="big">${avg}</div></div>
        <div class="kpi"><h4>Return</h4><div class="big">${posRet}%</div><div class="stack"><span class="seg g" style="width:${posRet}%"></span></div></div>
        <div class="kpi"><h4>Stable</h4><div class="big">${stablePct}%</div><div class="stack"><span class="seg g" style="width:${stablePct}%"></span></div></div>
        <div class="kpi"><h4>Pressured</h4><div class="big">${pressuredPct}%</div><div class="stack"><span class="seg r" style="width:${pressuredPct}%"></span></div></div>
      </div>

      <div class="card">
        <h2>Return distribution</h2>
        <div class="stack">
          <span class="seg g" style="width:${pct(retPos,total)}%"></span>
          <span class="seg a" style="width:${pct(retNeu,total)}%"></span>
          <span class="seg r" style="width:${pct(retNeg,total)}%"></span>
        </div>
        <div class="legend">
          <span>Positive: ${pct(retPos,total)}%</span>
          <span>Neutral: ${pct(retNeu,total)}%</span>
          <span>Negative: ${pct(retNeg,total)}%</span>
        </div>
      </div>

      <div class="card">
        <h2>Stability distribution</h2>
        <div class="stack">
          <span class="seg g" style="width:${pct(stabSt,total)}%"></span>
          <span class="seg a" style="width:${pct(stabUn,total)}%"></span>
          <span class="seg r" style="width:${pct(stabFr,total)}%"></span>
        </div>
        <div class="legend">
          <span>Stable: ${pct(stabSt,total)}%</span>
          <span>Uncertain: ${pct(stabUn,total)}%</span>
          <span>Fragile: ${pct(stabFr,total)}%</span>
        </div>
      </div>

      <div class="card">
        <h2>Pressure distribution</h2>
        <div class="stack">
          <span class="seg r" style="width:${pct(prPress,total)}%"></span>
          <span class="seg a" style="width:${pct(prBal,total)}%"></span>
          <span class="seg g" style="width:${pct(prCalm,total)}%"></span>
        </div>
        <div class="legend">
          <span>Pressured: ${pct(prPress,total)}%</span>
          <span>Balanced: ${pct(prBal,total)}%</span>
          <span>Calm: ${pct(prCalm,total)}%</span>
        </div>
      </div>

      <div class="card">
        <h2>Drive (U×C) by category</h2>
        <div class="rows">
          ${
            catRows.length
              ? catRows.map(r=>`
                <div class="row">
                  <div><strong>${escapeHtml(r.cat)}</strong></div>
                  <div class="bar"><span style="width:${r.share}%"></span></div>
                  <div class="mini" style="text-align:right;">
                    ${r.share}% of drive • ${r.count} decisions • avg D-NAV ${r.avgD} • stable ${r.st}% • pressured ${r.pr}%
                  </div>
                </div>`).join('')
              : '<div class="mini">No data.</div>'
          }
        </div>
      </div>

      <div class="card">
        <h2>Decision log</h2>
        ${
          rows.length
            ? `<table>
                <thead><tr><th>When</th><th>Name</th><th>Category</th><th class="right">R</th><th class="right">P</th><th class="right">S</th><th class="right">D-NAV</th></tr></thead>
                <tbody>
                  ${rows.slice(0,40).map(r=>`<tr>
                    <td>${new Date(r.ts).toLocaleString()}</td>
                    <td>${escapeHtml(r.name||'')}</td>
                    <td>${escapeHtml(r.category||'')}</td>
                    <td class="right">${r.return>=0?'+':''}${r.return}</td>
                    <td class="right">${r.pressure>=0?'+':''}${r.pressure}</td>
                    <td class="right">${r.stability>=0?'+':''}${r.stability}</td>
                    <td class="right"><b>${r.dnav}</b></td>
                  </tr>`).join('')}
                </tbody>
              </table>`
            : '<div class="mini">No decisions saved yet.</div>'
        }
      </div>

      <div class="cta">
        <a target="_blank" rel="noopener noreferrer" href="https://decisionnavigator.gumroad.com/">
          Want deeper insights from your decisions? Download the D-NAV template and see the story in all your decisions.
        </a>
      </div>
    </div>
  </body></html>`;
  const w = window.open('', '_blank');
  if(!w){ alert('Please allow pop-ups to view the PDF.'); return; }
  w.document.open(); w.document.write(html); w.document.close();
  try{ w.focus(); }catch{}
}

/* ---------- Animated Stats / rendering ---------- */
function animateNumber(el, to, {suffix='', duration=500}={}){
  const from = Number(el.dataset.val || 0);
  const start = performance.now();
  function step(t){
    const p = Math.min(1, (t - start)/duration);
    const v = Math.round(from + (to - from)*p);
    el.textContent = v + suffix;
    if(p < 1){ requestAnimationFrame(step); } else { el.dataset.val = to; }
  }
  requestAnimationFrame(step);
}
function pulse(tile){ tile.classList.remove('pulse'); void tile.offsetWidth; tile.classList.add('pulse'); }
function filterRows(rows){
  const days = Number($('#rangeSelect').value || 0);
  if(!days) return rows;
  const cutoff = Date.now() - days*24*60*60*1000;
  return rows.filter(r=>r.ts >= cutoff);
}
function renderAlloc(rows){
  const list = $('#allocList');
  if(!rows.length){ list.innerHTML = '<div class="mini">No data in range.</div>'; return; }
  const totals = new Map(); let energyAll = 0;
  rows.forEach(r=>{
    const cat=(r.category||'').trim()||'Uncategorized';
    const e = (r.urgency||0)*(r.confidence||0);
    energyAll += e;
    if(!totals.has(cat)) totals.set(cat,{energy:0,count:0,sumD:0,press:0,stable:0});
    const t=totals.get(cat);
    t.energy += e; t.count += 1; t.sumD += (Number(r.dnav)||0);
    if((r.pressure||0) > 0) t.press += 1;
    if((r.stability||0) > 0) t.stable += 1;
  });
  const rowsData = Array.from(totals.entries()).map(([cat,t])=>{
    const share = energyAll? Math.round(t.energy*100/energyAll) : 0;
    const avgD = Math.round(t.sumD / t.count);
    const pr = Math.round(t.press*100/t.count);
    const st = Math.round(t.stable*100/t.count);
    return {cat, share, avgD, count:t.count, pr, st};
  }).sort((a,b)=>b.share-a.share).slice(0,8);

  list.innerHTML = rowsData.map(r=>`
    <div class="row">
      <div><strong>${escapeHtml(r.cat)}</strong></div>
      <div class="bar"><span style="width:${r.share}%"></span></div>
      <div class="meta">${r.share}% of drive • ${r.count} decisions • avg D-NAV ${r.avgD} • stable ${r.st}% • pressured ${r.pr}%</div>
    </div>
  `).join('');
}
function renderStats(allRows){
  const rows = filterRows(allRows);
  const total = rows.length;

  const avg = total ? Math.round(rows.reduce((a,r)=>a + (Number(r.dnav)||0),0)/total) : 0;
  const posRet = total ? Math.round(rows.filter(r=>r.return>0).length*100/total) : 0;
  const pressured = total ? Math.round(rows.filter(r=>r.pressure>0).length*100/total) : 0;
  const stable = total ? Math.round(rows.filter(r=>r.stability>0).length*100/total) : 0;

  const counts = new Map();
  rows.forEach(r=>{ const c=(r.category||'').trim(); if(!c) return; counts.set(c,(counts.get(c)||0)+1); });
  let topCat='—', topCatCount=0;
  counts.forEach((v,k)=>{ if(v>topCatCount){ topCat=k; topCatCount=v; } });

  const aCounts = new Map();
  rows.forEach(r=>{
    const key=[Math.sign(r.pressure),Math.sign(r.stability),Math.sign(r.return)].join('|');
    const n=oneWord[key]; if(!n) return;
    aCounts.set(n,(aCounts.get(n)||0)+1);
  });
  let topArch='—', topArchCount=0;
  aCounts.forEach((v,k)=>{ if(v>topArchCount){ topArch=k; topArchCount=v; } });

  animateNumber($('#k_total'), total);
  $('#k_recent').textContent = `(${total} in range)`;
  animateNumber($('#k_avgdnav'), avg);
  animateNumber($('#k_posret'), posRet, {suffix:'%'});   $('#bar_posret').style.width = posRet + '%';
  animateNumber($('#k_stable'),  stable,  {suffix:'%'});   $('#bar_stable').style.width = stable + '%';
  animateNumber($('#k_pressured'), pressured, {suffix:'%'}); $('#bar_press').style.width = pressured + '%';

  pulse($('#tile_total')); pulse($('#tile_avg')); pulse($('#tile_pos')); pulse($('#tile_stable')); pulse($('#tile_press'));

  $('#k_misc').textContent = `Top category: ${topCat} • Top archetype: ${topArch}`;

  renderAlloc(rows);
}

function renderLog(){
  const rows=loadLog();
  const tbody=$('#logBody');
  tbody.innerHTML = rows.map((r,i)=>`
    <tr>
      <td>${new Date(r.ts).toLocaleString()}</td>
      <td>${escapeHtml(r.name)}</td>
      <td>${escapeHtml(r.category||'')}</td>
      <td class="num">${fmt0(r.impact)}</td>
      <td class="num">${fmt0(r.cost)}</td>
      <td class="num">${fmt0(r.risk)}</td>
      <td class="num">${fmt0(r.urgency)}</td>
      <td class="num">${fmt0(r.confidence)}</td>
      <td class="num">${fmt0(r.return)}</td>
      <td class="num">${fmt0(r.pressure)}</td>
      <td class="num">${fmt0(r.stability)}</td>
      <td class="num" style="font-weight:700;">${fmt0(r.dnav)}</td>
      <td style="text-align:center;">
        <button data-idx="${i}" class="del" style="border:0;background:transparent;color:#fff;cursor:pointer;">✕</button>
      </td>
    </tr>
  `).join('');

  tbody.querySelectorAll('button.del').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const idx=Number(btn.getAttribute('data-idx'));
      const arr=loadLog(); arr.splice(idx,1); saveLog(arr); renderLog();
    });
  });

  renderStats(rows);
}

function resetForm(){
  SLIDER_IDS.forEach(id=>{ const el=$('#'+id); el.value=1; });
  $('#decisionName').value='';
  $('#decisionCategory').value='';
  compute();
  $('#enterBtn').disabled = true;
}
function checkFormValid(){
  const nameOk = $('#decisionName').value.trim().length>0;
  const catOk  = $('#decisionCategory').value.trim().length>0;
  $('#enterBtn').disabled = !(nameOk && catOk);
}
function enterDecision(){
  const btn=$('#enterBtn'); if(btn.disabled) return;
  btn.disabled = true;
  const name=$('#decisionName').value.trim();
  const category=$('#decisionCategory').value.trim();
  if(!name || !category){ btn.disabled=false; return; }

  const vals=readCurrent();
  const m=computeMetrics(vals);

  const row={
    ts:Date.now(),
    name, category,
    ...vals,
    return:m.ret, pressure:m.pressure, stability:m.stability, merit:m.merit, energy:m.energy, dnav:m.dnav
  };

  const arr=loadLog();
  arr.unshift(row);
  saveLog(arr);
  renderLog();
  resetForm();
}

/* ---- Upload UI wiring ---- */
const csvInput = document.getElementById('csvInput');
const uploadBtn = document.getElementById('uploadBtn');
const uploadMsg = document.getElementById('uploadMsg');

csvInput.addEventListener('change', ()=>{
  uploadBtn.disabled = !csvInput.files || !csvInput.files.length;
  uploadMsg.textContent = csvInput.files && csvInput.files.length ? `Selected: ${csvInput.files[0].name}` : '';
});
uploadBtn.addEventListener('click', async ()=>{
  if(!csvInput.files || !csvInput.files.length) return;
  const file = csvInput.files[0];
  try{
    const text = await file.text();
    const res = importCSV(text);
    uploadMsg.textContent = `Imported ${res.count} rows.`;
    uploadMsg.style.color = '#9fe7b6';
    renderLog();
    csvInput.value = '';
    uploadBtn.disabled = true;
  }catch(err){
    uploadMsg.textContent = `Import failed: ${err.message||err}`;
    uploadMsg.style.color = '#ffb3b3';
  }
});

/* ---- Template buttons ---- */
document.getElementById('tmplBlank').addEventListener('click', blankTemplate);
document.getElementById('tmplPersonal').addEventListener('click', personalTemplate);
document.getElementById('tmplBusiness').addEventListener('click', businessTemplate);
document.getElementById('tmplInvestor').addEventListener('click', investorTemplate);

/* keep sliders live */
SLIDER_IDS.forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener('input', compute);
  el.addEventListener('change', compute);
});
/* enable + click handlers for entry form and exports */
document.getElementById('decisionName').addEventListener('input', checkFormValid);
document.getElementById('decisionCategory').addEventListener('input', checkFormValid);
document.getElementById('enterBtn').addEventListener('click', enterDecision);
document.getElementById('downloadCsvBtn').addEventListener('click', downloadCsv);
document.getElementById('downloadPdfBtn').addEventListener('click', openPdfReport);
document.getElementById('clearLogBtn').addEventListener('click', ()=>{
  if(confirm('Clear all saved decisions?')){ saveLog([]); renderLog(); }
});

/* boot */
document.getElementById('allocTitle').textContent = 'Drive (U×C) by category';
compute();
renderLog();
</script>
</body>
</html>
